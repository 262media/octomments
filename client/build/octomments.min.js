!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).Octomments=n()}(this,function(){"use strict";var e,r=(function(e,n){function l(e){return r[e]||e}var r,u,g,f,p,m,s,h,d,w,v,$,b,_,x,E,I,O,k,y,T,q,j,C,S,R,L,M,N,U,z,P,A,D,G,H,J,K,X,B,F,Q,V,W,Y,Z,ee,ne,re;e.exports=(r={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","&":"&amp;","[":"&#91;","]":"&#93;","(":"&#40;",")":"&#41;"},u=/[<>&\(\)\[\]"']/g,g=/<(script)[^\0]*?>([^\0]+?)<\/(script)>/gim,f="&lt;$1&gt;$2&lt;/$3&gt;",p=/(<.*? [^\0]*?=[^\0]*?)(javascript:.*?)(.*>)/gim,m="$1#$2&#58;$3",s=/<img([^\0]*?onerror=)([^\0]*?)>/gim,h=function(e,n,r){return"<img"+n+r.replace(u,l)+">"},d=/^[\t ]+|[\t ]$/gm,w=/(<.*>[\t ]*\n^.*)/gm,$=/(<style>[^]*<\/style>)/gm,b=v=function(e,n){return n.replace(/^\n|$\n/gm,"")},_=/(<[^]+?)(on.*?=.*?)(.*>)/gm,x="$1$3",E=/^[ \t]*> (.*)/gm,I="<blockquote>$1</blockquote>",O=/`([^`]+?)`/g,k=function(e,n){return"<code>"+n.replace(u,l)+"</code>"},y=/```(.*)\n([^\0]+?)```(?!```)/gm,T=/!\[(.*)\]\((.*)\)/g,q=function(e,n,r){return'<img src="'+r.replace(u,l)+'" alt="'+n.replace(u,l)+'">'},j=/^(#+) +(.*)/gm,C=function(e,n,r){var t=n.length;return"<h"+t+">"+r+"</h"+t+">"},S=/^([^\n\t ])(.*)\n----+/gm,R=/^([^\n\t ])(.*)\n====+/gm,L="<h1>$1$2</h1>",M="<h2>$1$2</h2>",N=/^([^-><#\d\+\_\*\t\n\[\! \{])([^]*?)(|  )(?:\n\n)/gm,U=function(e,n,r,t){return"<p>"+n+r+"</p>"+(t?"\n<br>\n":"\n")},z=/^.*?(?:---|\*\*\*|- - -|\* \* \*)/gm,P="<hr>",A=/(?:\*\*|\_\_)([^\*\n_]+?)(?:\*\*|\_\_)/g,D="<strong>$1</strong>",G=/(?:\*|\_)([^\*\n_]+?)(?:\*|\_)/g,H="<em>$1</em>",J=/(?:~~)([^~]+?)(?:~~)/g,K="<del>$1</del>",X=/\[(.*?)\]\(([^\t\n ]*)(?:| "(.*)")\)+/gm,B=function(e,n,r,t){var o=r.replace(u,l),c=n.replace(u,l);return'<a href="'+o+'"'+(t?' title="'+t.replace(u,l)+'"':"")+">"+c+"</a>"},F=/^[\t ]*?(?:-|\+|\*) (.*)/gm,Q=/(\<\/ul\>\n(.*)\<ul\>*)+/g,V="<ul><li>$1</li></ul>",W=/^[\t ]*?(?:\d(?:\)|\.)) (.*)/gm,Y=/(\<\/ol\>\n(.*)\<ol\>*)+/g,Z="<ol><li>$1</li></ol>",ee=/^\n\n+/gm,ne=/\[( |x)\]/g,re=function(e,n){return'<input type="checkbox" disabled'+("x"===n.toLowerCase()?" checked":"")+">"},function(e){if(!e)return"";var c=[],i=0,n=e.length;"\n"!==e[n-1]&&"\n"!==e[n-2]&&(e+="\n\n");e=e.replace(y,function(e,n,r){var t="{code-block-"+i+"}",o=new RegExp("{code-block-"+i+"}","g");return c[i++]={lang:n,block:r.replace(u,l),regex:o},t}).replace(g,f).replace(s,h).replace(_,x).replace(d,"").replace(E,I).replace(T,q).replace(j,C).replace(R,L).replace(S,M).replace(z,P).replace(ne,re).replace(w,v).replace($,b).replace(N,U).replace(O,k).replace(X,B).replace(F,V).replace(Q,"").replace(W,Z).replace(Y,"").replace(A,D).replace(G,H).replace(J,K).replace(ee,"<br>").replace(p,m);for(var r=0;r<i;r++){var t=c[r],o=t.lang,a=t.block;e=e.replace(t.regex,function(e){return'<pre><code class="language-'+o+'">'+a+"</code></pre>"})}return e.trim()})}(e={exports:{}},e.exports),e.exports);var h="OCTOMMENTS_GH_TOKEN",d=!0===function(){var e="test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}()?localStorage:{setItem:function(){},getITem:function(){}};function w(e){return{author:{name:(n=e.user).login,avatar:n.avatar_url,url:n.html_url},text:r(e.body),url:e.html_url};var n}return function(e){var n=e.githubClientId,r=e.getTokenURL,t=e.owner,o=e.repo,c=e.issue,i=e.onLoggedIn,a=e.onError;if(!n)throw new Error('Octomments: "githubClientId" is required.');if(!r)throw new Error('Octomments: "getTokenURL" is required.');if(!t)throw new Error('Octomments: "owner" is required.');if(!o)throw new Error('Octomments: "repo" is required.');if(!c)throw new Error('Octomments: "issue" is required.');a=a||function(e){return console.error(e)},i=i||function(){};var l="https://api.github.com/repos/".concat(t,"/").concat(o,"/issues/").concat(c),u=d.getItem(h);function g(){var e=["client_id=".concat(n),"redirect_uri=".concat(encodeURI(window.location.href))];return"https://github.com/login/oauth/authorize?".concat(e.join("&"))}var f,p,m={onError:function(e){a=e},onLoggedIn:function(e){i=e},get:function(){var r=[];return new Promise(function(n,e){fetch(l+c).then(function(e){return e.json()}).then(function(e){return r.push(e),fetch(e.comments_url).then(function(e){return e.json()})}).then(function(e){r=r.concat(e),n(r.map(w))}).catch(a)})},add:function(e){var n;u?(n=e,fetch("".concat(l,"/comments"),{method:"POST",body:JSON.stringify({body:n}),headers:{Authorization:"token ".concat(u)}}).then(function(e){return e.json}).then(function(e){console.log(e)}).catch(function(e){console.error(e)})):(d.setItem("OCTOMMENTS_TEXT",e),window.location.href=g())},login:function(){window.location.href=g()}},s=function(e,n){n=n||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(n);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}("code",window.location.href);return s&&(f=s,p=function(e,n){e||(u=n,d.setItem(h,n),i(n)),a(e)},fetch("".concat(r,"?").concat(f,"&CID=").concat(n)).then(function(e,n){if(!n)return e.json();p(n)}).then(function(e,n){n||e&&e.error?p(new Error(e.error)):p(null,e)}).catch(p)),m}});